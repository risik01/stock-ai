<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“° News Trading AI Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        .sentiment-positive { color: #28a745; font-weight: bold; }
        .sentiment-negative { color: #dc3545; font-weight: bold; }
        .sentiment-neutral { color: #6c757d; font-weight: bold; }
        
        .news-card {
            transition: transform 0.2s;
            border-left: 4px solid #007bff;
        }
        
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .breaking-news {
            border-left-color: #dc3545 !important;
            background-color: #fff5f5;
        }
        
        .signal-buy { background-color: #d4edda; border-left: 4px solid #28a745; }
        .signal-sell { background-color: #f8d7da; border-left: 4px solid #dc3545; }
        .signal-hold { background-color: #fff3cd; border-left: 4px solid #ffc107; }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-running { background-color: #28a745; }
        .status-stopped { background-color: #dc3545; }
        
        .portfolio-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
        }
        
        .auto-refresh {
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .alert-critical { border-left: 4px solid #dc3545; background-color: #f8d7da; }
        .alert-warning { border-left: 4px solid #ffc107; background-color: #fff3cd; }
        .alert-info { border-left: 4px solid #17a2b8; background-color: #d1ecf1; }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line"></i> News Trading AI
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item">
                    <span class="navbar-text">
                        <span id="trading-status" class="status-indicator status-stopped"></span>
                        <span id="trading-status-text">Stopped</span>
                    </span>
                </div>
                <div class="nav-item ms-3">
                    <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                        <i id="refresh-icon" class="fas fa-sync-alt"></i> Aggiorna
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title"><i class="fas fa-newspaper"></i> Notizie</h5>
                        <h2 id="news-count">-</h2>
                        <small>Articoli raccolti</small>
                        <div class="mt-2">
                            <span class="badge bg-danger" id="breaking-count">0 Breaking</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card portfolio-card h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title"><i class="fas fa-wallet"></i> Portfolio</h5>
                        <h2 id="portfolio-value">$0</h2>
                        <small>Valore totale</small>
                        <div class="mt-2">
                            <span id="portfolio-performance" class="badge bg-light text-dark">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card metric-card h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title"><i class="fas fa-chart-bar"></i> Sentiment</h5>
                        <h2 id="market-sentiment">-</h2>
                        <small id="market-mood">Analizzando...</small>
                        <div class="mt-2">
                            <span class="badge bg-light text-dark" id="sentiment-symbols">0 simboli</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card metric-card h-100">
                    <div class="card-body text-center">
                        <h5 class="card-title"><i class="fas fa-bullseye"></i> Segnali</h5>
                        <h2 id="signals-count">0</h2>
                        <small>Segnali attivi</small>
                        <div class="mt-2">
                            <span class="badge bg-warning" id="alerts-count">0 Alert</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-cogs"></i> Controllo Trading</h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text">Intervallo</span>
                                    <input type="number" id="trading-interval" class="form-control" 
                                           value="10" min="1" max="60">
                                    <span class="input-group-text">min</span>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <button id="start-auto-btn" class="btn btn-success me-2" onclick="startAutoTrading()">
                                    <i class="fas fa-play"></i> Avvia Auto Trading
                                </button>
                                <button id="stop-auto-btn" class="btn btn-danger me-2" onclick="stopAutoTrading()" disabled>
                                    <i class="fas fa-stop"></i> Ferma Auto Trading
                                </button>
                                <button class="btn btn-primary me-2" onclick="executeTradingCycle()">
                                    <i class="fas fa-sync"></i> Esegui Ciclo
                                </button>
                                <button class="btn btn-info" onclick="exportReport()">
                                    <i class="fas fa-download"></i> Esporta Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Trading Signals -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-bullseye"></i> Segnali di Trading</h5>
                        <small class="text-muted" id="signals-last-updated">-</small>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="trading-signals">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin"></i> Caricamento segnali...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Status -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-chart-pie"></i> Portfolio</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="text-center">
                                    <h6>Cash</h6>
                                    <h4 id="portfolio-cash" class="text-success">$0</h4>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <h6>Posizioni</h6>
                                    <h4 id="portfolio-positions-value" class="text-info">$0</h4>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container mb-3">
                            <canvas id="portfolio-chart"></canvas>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-6">
                                <small class="text-muted">Trades Totali</small>
                                <div id="portfolio-trades" class="fw-bold">0</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Posizioni Aperte</small>
                                <div id="portfolio-positions-count" class="fw-bold">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- News and Sentiment -->
        <div class="row">
            <!-- Latest News -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-newspaper"></i> Ultime Notizie</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="loadBreakingNews()">
                                <i class="fas fa-exclamation-triangle"></i> Breaking
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="loadLatestNews()">
                                <i class="fas fa-refresh"></i> Aggiorna
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 500px; overflow-y: auto;">
                        <div id="news-feed">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin"></i> Caricamento notizie...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sentiment & Alerts -->
            <div class="col-md-4">
                <!-- Market Sentiment -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-chart-bar"></i> Sentiment Mercato</h6>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="sentiment-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Active Alerts -->
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Alert Attivi</h6>
                    </div>
                    <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                        <div id="active-alerts">
                            <div class="text-center text-muted">
                                <i class="fas fa-check-circle"></i> Nessun alert attivo
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toast-container"></div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Variables globali
        let portfolioChart = null;
        let sentimentChart = null;
        let refreshInterval = null;

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            refreshData();
            checkAutoTradingStatus();
            
            // Auto refresh ogni 30 secondi
            refreshInterval = setInterval(refreshData, 30000);
        });

        function initCharts() {
            // Portfolio Chart
            const portfolioCtx = document.getElementById('portfolio-chart').getContext('2d');
            portfolioChart = new Chart(portfolioCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Cash', 'Posizioni'],
                    datasets: [{
                        data: [100, 0],
                        backgroundColor: ['#28a745', '#17a2b8'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Sentiment Chart
            const sentimentCtx = document.getElementById('sentiment-chart').getContext('2d');
            sentimentChart = new Chart(sentimentCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Sentiment Score',
                        data: [],
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            return value > 0.1 ? '#28a745' : value < -0.1 ? '#dc3545' : '#ffc107';
                        },
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: -1,
                            max: 1
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        async function refreshData() {
            const refreshIcon = document.getElementById('refresh-icon');
            refreshIcon.classList.add('auto-refresh');
            
            try {
                await Promise.all([
                    loadDashboardStats(),
                    loadTradingSignals(),
                    loadPortfolioStatus(),
                    loadLatestNews(),
                    loadSentimentOverview(),
                    loadActiveAlerts()
                ]);
            } catch (error) {
                console.error('Errore durante refresh:', error);
                showToast('Errore durante aggiornamento dati', 'error');
            } finally {
                refreshIcon.classList.remove('auto-refresh');
            }
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/stats/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    
                    // Aggiorna stats cards
                    document.getElementById('news-count').textContent = stats.news.total_articles;
                    document.getElementById('breaking-count').textContent = `${stats.news.breaking_news} Breaking`;
                    
                    document.getElementById('portfolio-value').textContent = 
                        `$${stats.portfolio.total_value.toLocaleString()}`;
                    
                    document.getElementById('market-sentiment').textContent = 
                        stats.sentiment.market_sentiment.toFixed(3);
                    document.getElementById('market-mood').textContent = stats.sentiment.market_mood;
                    document.getElementById('sentiment-symbols').textContent = 
                        `${stats.sentiment.analyzed_symbols} simboli`;
                    
                    document.getElementById('signals-count').textContent = stats.trading.active_signals;
                    document.getElementById('alerts-count').textContent = `${stats.trading.active_alerts} Alert`;
                }
            } catch (error) {
                console.error('Errore caricamento stats:', error);
            }
        }

        async function loadTradingSignals() {
            try {
                const response = await fetch('/api/trading/signals');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('trading-signals');
                    
                    if (data.signals.length === 0) {
                        container.innerHTML = '<div class="text-center text-muted">Nessun segnale attivo</div>';
                        return;
                    }
                    
                    let html = '';
                    data.signals.forEach(signal => {
                        const actionClass = signal.action === 'BUY' ? 'signal-buy' : 
                                          signal.action === 'SELL' ? 'signal-sell' : 'signal-hold';
                        const actionIcon = signal.action === 'BUY' ? 'fa-arrow-up' : 
                                         signal.action === 'SELL' ? 'fa-arrow-down' : 'fa-minus';
                        
                        html += `
                            <div class="card mb-2 ${actionClass}">
                                <div class="card-body py-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-0">
                                                <i class="fas ${actionIcon}"></i> ${signal.symbol} - ${signal.action}
                                            </h6>
                                            <small class="text-muted">${signal.reason}</small>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold">Conf: ${(signal.confidence * 100).toFixed(0)}%</div>
                                            <small>Sentiment: ${signal.sentiment_score.toFixed(2)}</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    document.getElementById('signals-last-updated').textContent = 
                        new Date(data.last_updated).toLocaleTimeString();
                }
            } catch (error) {
                console.error('Errore caricamento segnali:', error);
            }
        }

        async function loadPortfolioStatus() {
            try {
                const response = await fetch('/api/trading/portfolio');
                const data = await response.json();
                
                if (data.success) {
                    const portfolio = data.portfolio;
                    
                    // Aggiorna valori portfolio
                    document.getElementById('portfolio-cash').textContent = 
                        `$${portfolio.cash.toLocaleString()}`;
                    document.getElementById('portfolio-positions-value').textContent = 
                        `$${portfolio.total_position_value.toLocaleString()}`;
                    document.getElementById('portfolio-trades').textContent = portfolio.trade_count;
                    document.getElementById('portfolio-positions-count').textContent = 
                        Object.keys(portfolio.positions || {}).length;
                    
                    // Performance
                    const performance = portfolio.performance_pct || 0;
                    const perfElement = document.getElementById('portfolio-performance');
                    perfElement.textContent = `${performance.toFixed(2)}%`;
                    perfElement.className = performance >= 0 ? 'badge bg-success' : 'badge bg-danger';
                    
                    // Aggiorna chart
                    if (portfolioChart) {
                        portfolioChart.data.datasets[0].data = [
                            portfolio.cash_pct || 0,
                            portfolio.positions_pct || 0
                        ];
                        portfolioChart.update();
                    }
                }
            } catch (error) {
                console.error('Errore caricamento portfolio:', error);
            }
        }

        async function loadLatestNews() {
            try {
                const response = await fetch('/api/news/latest');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('news-feed');
                    
                    if (data.news.length === 0) {
                        container.innerHTML = '<div class="text-center text-muted">Nessuna notizia disponibile</div>';
                        return;
                    }
                    
                    let html = '';
                    data.news.forEach(news => {
                        const publishedTime = new Date(news.published).toLocaleString();
                        const symbols = news.symbols.length > 0 ? news.symbols.join(', ') : 'General';
                        
                        html += `
                            <div class="card news-card mb-3">
                                <div class="card-body">
                                    <h6 class="card-title mb-2">${news.title}</h6>
                                    <p class="card-text small text-muted mb-2">${news.summary}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <span class="badge bg-primary">${news.source}</span>
                                            <span class="badge bg-secondary">${symbols}</span>
                                        </div>
                                        <small class="text-muted">${publishedTime}</small>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('Errore caricamento notizie:', error);
            }
        }

        async function loadBreakingNews() {
            try {
                const response = await fetch('/api/news/breaking');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('news-feed');
                    
                    if (data.breaking_news.length === 0) {
                        container.innerHTML = '<div class="text-center text-muted">Nessuna breaking news</div>';
                        return;
                    }
                    
                    let html = '';
                    data.breaking_news.forEach(news => {
                        const publishedTime = new Date(news.published).toLocaleString();
                        const symbols = news.symbols.length > 0 ? news.symbols.join(', ') : 'General';
                        
                        html += `
                            <div class="card news-card breaking-news mb-3">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-danger me-2">BREAKING</span>
                                        <h6 class="card-title mb-0">${news.title}</h6>
                                    </div>
                                    <p class="card-text small text-muted mb-2">${news.summary}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <span class="badge bg-primary">${news.source}</span>
                                            <span class="badge bg-secondary">${symbols}</span>
                                        </div>
                                        <small class="text-muted">${publishedTime}</small>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('Errore caricamento breaking news:', error);
            }
        }

        async function loadSentimentOverview() {
            try {
                const response = await fetch('/api/sentiment/overview');
                const data = await response.json();
                
                if (data.success) {
                    const overview = data.sentiment_overview;
                    
                    // Aggiorna sentiment chart
                    if (sentimentChart && overview.symbol_details) {
                        const symbols = Object.keys(overview.symbol_details);
                        const sentiments = symbols.map(symbol => 
                            overview.symbol_details[symbol].sentiment_score
                        );
                        
                        sentimentChart.data.labels = symbols;
                        sentimentChart.data.datasets[0].data = sentiments;
                        sentimentChart.update();
                    }
                }
            } catch (error) {
                console.error('Errore caricamento sentiment:', error);
            }
        }

        async function loadActiveAlerts() {
            try {
                const response = await fetch('/api/alerts/active');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('active-alerts');
                    
                    if (data.alerts.length === 0) {
                        container.innerHTML = '<div class="text-center text-muted"><i class="fas fa-check-circle"></i> Nessun alert attivo</div>';
                        return;
                    }
                    
                    let html = '';
                    data.alerts.forEach(alert => {
                        const severityClass = alert.severity === 'critical' ? 'alert-critical' : 
                                            alert.severity === 'warning' ? 'alert-warning' : 'alert-info';
                        const severityIcon = alert.severity === 'critical' ? 'fa-exclamation-triangle' : 
                                           alert.severity === 'warning' ? 'fa-exclamation' : 'fa-info';
                        
                        html += `
                            <div class="card mb-2 ${severityClass}">
                                <div class="card-body py-2">
                                    <div class="d-flex align-items-center">
                                        <i class="fas ${severityIcon} me-2"></i>
                                        <div>
                                            <h6 class="mb-0">${alert.symbol}</h6>
                                            <small>${alert.message}</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('Errore caricamento alert:', error);
            }
        }

        async function startAutoTrading() {
            const interval = document.getElementById('trading-interval').value;
            
            try {
                const response = await fetch('/api/trading/auto/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ interval: parseInt(interval) })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('Trading automatico avviato', 'success');
                    updateTradingStatus(true);
                } else {
                    showToast('Errore avvio trading: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('Errore avvio trading: ' + error.message, 'error');
            }
        }

        async function stopAutoTrading() {
            try {
                const response = await fetch('/api/trading/auto/stop', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast('Trading automatico fermato', 'info');
                    updateTradingStatus(false);
                } else {
                    showToast('Errore stop trading: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('Errore stop trading: ' + error.message, 'error');
            }
        }

        async function executeTradingCycle() {
            try {
                showToast('Esecuzione ciclo di trading...', 'info');
                
                const response = await fetch('/api/trading/cycle', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const result = data.cycle_result;
                    showToast(`Ciclo completato: ${result.trades_executed || 0} trades eseguiti`, 'success');
                    refreshData();
                } else {
                    showToast('Errore esecuzione ciclo: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('Errore esecuzione ciclo: ' + error.message, 'error');
            }
        }

        async function exportReport() {
            try {
                const response = await fetch('/api/export/report');
                const data = await response.json();
                
                if (data.success) {
                    showToast('Report esportato: ' + data.report_file, 'success');
                } else {
                    showToast('Errore esportazione: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('Errore esportazione: ' + error.message, 'error');
            }
        }

        async function checkAutoTradingStatus() {
            try {
                const response = await fetch('/api/trading/auto/status');
                const data = await response.json();
                
                if (data.success) {
                    updateTradingStatus(data.is_running);
                }
            } catch (error) {
                console.error('Errore controllo status:', error);
            }
        }

        function updateTradingStatus(isRunning) {
            const statusIndicator = document.getElementById('trading-status');
            const statusText = document.getElementById('trading-status-text');
            const startBtn = document.getElementById('start-auto-btn');
            const stopBtn = document.getElementById('stop-auto-btn');
            
            if (isRunning) {
                statusIndicator.className = 'status-indicator status-running';
                statusText.textContent = 'Running';
                startBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                statusIndicator.className = 'status-indicator status-stopped';
                statusText.textContent = 'Stopped';
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = {
                'success': 'bg-success',
                'error': 'bg-danger',
                'warning': 'bg-warning',
                'info': 'bg-info'
            }[type] || 'bg-info';
            
            const toastHtml = `
                <div id="${toastId}" class="toast ${bgClass} text-white" role="alert">
                    <div class="toast-header ${bgClass} text-white border-0">
                        <strong class="me-auto">News Trading AI</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // Rimuovi il toast dopo che Ã¨ stato nascosto
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }

        // Gestione visibilitÃ  pagina
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Pausa refresh quando la pagina non Ã¨ visibile
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                }
            } else {
                // Riprendi refresh quando la pagina torna visibile
                refreshData();
                if (!refreshInterval) {
                    refreshInterval = setInterval(refreshData, 30000);
                }
            }
        });
    </script>
</body>
</html>
